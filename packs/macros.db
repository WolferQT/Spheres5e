{"name":"Update Martial Focus resources","type":"script","scope":"global","author":"jvc9MjSXj7pOw4bp","img":"icons/svg/dice-target.svg","command":"//console.log(canvas.tokens.controlled[0].actor);\nconst logStart = \"Wolfer Spheres5e | \"\n\nlet focus = game.packs.get(\"wolfer-spheres5e.might-features\").index.get(\"YxYeNurtsPWwnkXQ\");\nidArr = new Object();\nawait fetch('modules/wolfer-spheres5e/data/martial-focus-ids.json')\n  .then(response => response.text())\n  .then(text => {idArr = JSON.parse(text)});\n//console.log(idArr['spheres']);\n\nlet playerChars = game.actors;\nplayerChars.forEach(playerChar => {\n  if(playerChar.type == \"character\")\n  {\n    let featArr = playerChar.itemTypes.feat;\n    //console.log(featArr);\n    focusId = \"\";\n    \n    featArr.forEach(feature => {\n      if(feature.name == focus.name) {\n        focusId = feature.id;\n        feature.system.consume.target = focusId;\n        console.log(logStart + 'Successfully updated resource consume target for \"' + feature.name + '\" | ' + feature.id);\n      }\n    });\n    if(focusId == '')\n    {\n      console.log(logStart + 'Martial Focus item not found for actor ' + playerChar.name + '.');\n    }\n    else\n    {\n      let focusFeatures = new Map();\n      idArr['spheres'].forEach(sphere => {\n        sphere['ids'].forEach(feature => {\n          let temp = game.packs.get(sphere.name).index.get(feature);\n          focusFeatures.set(temp.name, temp);\n        });\n      });\n\n      //console.log(focusFeatures);\n      featArr.forEach(feature => {\n        if(focusFeatures.has(feature.name)) {\n          //console.log(feature);\n          feature.system.consume.target = focusId;\n          console.log('Wolfer Spheres5e | Successfully updated resource consume target for \"' + feature.name + '\" | ' + feature.id + ' for actor ' + playerChar.name);\n        }\n      });\n    }\n  }\n});","ownership":{"default":0,"jvc9MjSXj7pOw4bp":3},"flags":{"core":{"sourceId":"Macro.s9fBLYCb2pLJ2FMw"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.5","coreVersion":"10.291","createdTime":1684935463170,"modifiedTime":1685264063493,"lastModifiedBy":"camZNSGA5BPplWb5"},"folder":null,"sort":0,"_id":"5D3M0py43y4y1epA"}
{"name":"Update Spell Points resources","type":"script","scope":"global","author":"jvc9MjSXj7pOw4bp","img":"icons/svg/dice-target.svg","command":"const logStart = \"Wolfer Spheres5e | \";\nconst resourceTarget = \"resources.tertiary.value\";\nconst charCheckPack = \"wolfer-spheres5e.power-features\";\nconst charCheckId = \"UcBSN3vrCq3JVx2W\";\nconst featuresToUpdateFilePath = \"modules/wolfer-spheres5e/data/spell-points-ids.json\";\n\n\nlet spInitial = game.packs.get(charCheckPack).index.get(charCheckId);\nidArr = new Object();\nawait fetch(featuresToUpdateFilePath)\n  .then(response => response.text())\n  .then(text => {idArr = JSON.parse(text)});\n//console.log(idArr['spheres']);\n\nlet playerChars = game.actors;\nplayerChars.forEach(playerChar => {\n  if(playerChar.type == \"character\")\n  {\n    let featArr = playerChar.itemTypes.feat;\n    //console.log(featArr);\n    let spInitialFound = false;\n    \n    for(const feature of featArr) {\n      if(feature.name == spInitial.name) {\n        spInitialFound = true;\n        console.log(logStart + spInitial.name + \" item found for actor \" + playerChar.name);\n        break;\n      }\n    }\n    if(!spInitialFound)\n    {\n      console.log(logStart + 'Spell Points(Spherecaster) item not found for actor ' + playerChar.name + '.');\n    }\n    else\n    {\n      let spSpells = new Map();\n      for(sphere of idArr['spheres']) {\n        for(spell of sphere['ids']) {\n          let temp = game.packs.get(sphere.name).index.get(spell);\n          spSpells.set(temp.name, temp);\n        }\n      }\n\n      //console.log(spSpells);\n      let spellArr = playerChar.itemTypes.spell;\n      let logOutput = [];\n      spellArr.forEach(spell => {\n        if(spSpells.has(spell.name)) {\n          //console.log(feature);\n          spell.system.consume.target = resourceTarget;\n          logOutput.push('Wolfer Spheres5e | Successfully updated resource consume target for \"' + spell.name + '\" | ' + spell.id + ' for actor ' + playerChar.name);\n        }\n      });\n      console.log(logOutput);\n    }\n  }\n});","ownership":{"default":0,"jvc9MjSXj7pOw4bp":3},"flags":{"core":{"sourceId":"Macro.s9fBLYCb2pLJ2FMw"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.5","coreVersion":"10.291","createdTime":1684935463170,"modifiedTime":1685903444066,"lastModifiedBy":"jvc9MjSXj7pOw4bp"},"folder":null,"sort":0,"_id":"utGbQXpJNIQVLocd"}
